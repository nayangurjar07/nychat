<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ny chat </title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #FF69B4;
      --secondary: #FFB6C1;
      --accent: #DDA0DD;
      --background: #FFF0F5;
      --text: #8B008B;
      --success: #FF1493;
      --white: #FFFFFF;
      --light-pink: #FFE4E9;
      --shadow: rgba(255, 105, 180, 0.2);
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--background);
      color: var(--text);
      overflow: hidden;
    }

    .app-container {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Authentication Screen */
    .auth-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--background) 0%, var(--secondary) 100%);
      padding: 20px;
    }

    .auth-card {
      background: var(--white);
      padding: 40px;
      border-radius: 24px;
      box-shadow: 0 10px 40px var(--shadow);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }

    .auth-heart {
      font-size: 60px;
      margin-bottom: 20px;
      animation: heartbeat 1.5s ease-in-out infinite;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .auth-title {
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .auth-subtitle {
      color: var(--text);
      margin-bottom: 30px;
      font-size: 14px;
    }

    .input-group {
      margin-bottom: 20px;
      text-align: left;
    }

    .input-label {
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
      display: block;
    }

    .input-field {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--secondary);
      border-radius: 12px;
      font-size: 15px;
      font-family: 'Nunito', sans-serif;
      transition: all 0.3s ease;
      background: var(--white);
    }

    .input-field:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.1);
    }

    .auth-button {
      width: 100%;
      padding: 14px;
      background: var(--primary);
      color: var(--white);
      border: none;
      border-radius: 12px;
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .auth-button:hover {
      background: var(--success);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow);
    }

    .auth-button:active {
      transform: translateY(0);
    }

    .auth-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .error-message {
      background: #FFE4E9;
      color: #D32F2F;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    /* Chat Header */
    .chat-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px var(--shadow);
      position: relative;
    }

    .header-user {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--white);
    }

    .header-avatar {
      width: 40px;
      height: 40px;
      background: var(--white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .header-info h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .header-status {
      font-size: 12px;
      opacity: 0.9;
    }

    .logout-button {
      background: rgba(255, 255, 255, 0.2);
      color: var(--white);
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 8px 16px;
      border-radius: 20px;
      font-family: 'Poppins', sans-serif;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .logout-button:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Messages Area */
    .messages-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: var(--background);
    }

    .messages-container::-webkit-scrollbar {
      width: 8px;
    }

    .messages-container::-webkit-scrollbar-track {
      background: transparent;
    }

    .messages-container::-webkit-scrollbar-thumb {
      background: var(--secondary);
      border-radius: 4px;
    }

    .message {
      display: flex;
      flex-direction: column;
      max-width: 70%;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.sent {
      align-self: flex-end;
      align-items: flex-end;
    }

    .message.received {
      align-self: flex-start;
      align-items: flex-start;
    }

    .message-bubble {
      padding: 12px 16px;
      border-radius: 18px;
      word-wrap: break-word;
      position: relative;
    }

    .message.sent .message-bubble {
      background: var(--primary);
      color: var(--white);
      border-bottom-right-radius: 4px;
    }

    .message.received .message-bubble {
      background: var(--secondary);
      color: var(--text);
      border-bottom-left-radius: 4px;
    }

    .message-time {
      font-size: 11px;
      margin-top: 4px;
      opacity: 0.7;
    }

    .message.sent .message-time {
      color: var(--text);
    }

    .message.received .message-time {
      color: var(--text);
    }

    .empty-state {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--text);
      opacity: 0.6;
    }

    .empty-state-icon {
      font-size: 60px;
      margin-bottom: 16px;
    }

    .empty-state-text {
      font-family: 'Poppins', sans-serif;
      font-size: 18px;
    }

    /* Input Area */
    .input-container {
      background: var(--white);
      padding: 16px 20px;
      box-shadow: 0 -2px 10px var(--shadow);
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .emoji-button {
      width: 42px;
      height: 42px;
      background: var(--light-pink);
      border: none;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .emoji-button:hover {
      background: var(--secondary);
      transform: scale(1.1);
    }

    .message-input-wrapper {
      flex: 1;
      position: relative;
    }

    .message-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--secondary);
      border-radius: 24px;
      font-size: 15px;
      font-family: 'Nunito', sans-serif;
      resize: none;
      max-height: 120px;
      transition: all 0.3s ease;
    }

    .message-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.1);
    }

    .send-button {
      width: 42px;
      height: 42px;
      background: var(--success);
      border: none;
      border-radius: 50%;
      color: var(--white);
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .send-button:hover {
      background: var(--primary);
      transform: scale(1.1);
    }

    .send-button:active {
      transform: scale(0.95);
    }

    /* Emoji Picker */
    .emoji-picker {
      position: fixed;
      bottom: 90px;
      left: 20px;
      right: 20px;
      max-width: 500px;
      margin: 0 auto;
      background: var(--white);
      border-radius: 16px;
      box-shadow: 0 10px 40px var(--shadow);
      padding: 16px;
      display: none;
      z-index: 1000;
    }

    .emoji-picker.show {
      display: block;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .emoji-picker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--background);
    }

    .emoji-picker-title {
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
    }

    .emoji-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text);
      opacity: 0.6;
      transition: opacity 0.3s ease;
    }

    .emoji-close:hover {
      opacity: 1;
    }

    .emoji-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .emoji-tab {
      flex: 1;
      padding: 8px;
      background: var(--background);
      border: none;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--text);
    }

    .emoji-tab.active {
      background: var(--primary);
      color: var(--white);
    }

    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 8px;
      max-height: 240px;
      overflow-y: auto;
    }

    .emoji-grid::-webkit-scrollbar {
      width: 6px;
    }

    .emoji-grid::-webkit-scrollbar-track {
      background: transparent;
    }

    .emoji-grid::-webkit-scrollbar-thumb {
      background: var(--secondary);
      border-radius: 3px;
    }

    .emoji-item {
      font-size: 28px;
      padding: 8px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s ease;
      text-align: center;
      background: transparent;
      border: none;
    }

    .emoji-item:hover {
      background: var(--light-pink);
      transform: scale(1.2);
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: var(--background);
    }

    .loading-heart {
      font-size: 60px;
      animation: heartbeat 1s ease-in-out infinite;
    }

    .hidden {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 640px) {
      .emoji-grid {
        grid-template-columns: repeat(6, 1fr);
      }
      
      .message {
        max-width: 85%;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="loading">
      <div class="loading-heart">ğŸ’•</div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyD2O0sskAgvVzExwvr7ogfKLPkISVycrSk",
      authDomain: "lychat-93777.firebaseapp.com",
      projectId: "lychat-93777",
      storageBucket: "lychat-93777.firebasestorage.app",
      messagingSenderId: "514560697275",
      appId: "1:514560697275:web:940e664568929e01c11a9e",
      measurementId: "G-R9QY1QZPBD"
    };

    // IMPORTANT: Add the two allowed email addresses here
    const ALLOWED_USERS = [
      "07nayangurjar@gmail.com",
      "singhyashika449308@gmail.com"
    ];

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Emoji categories
    const emojiCategories = {
      romantic: ['ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’“', 'ğŸ’', 'ğŸ’', 'â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ¤', 'ğŸ–¤', 'ğŸ¤', 'â£ï¸', 'ğŸ’Œ', 'ğŸ’‹', 'ğŸ˜˜', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜»', 'ğŸ’‘', 'ğŸ’', 'ğŸ‘©â€â¤ï¸â€ğŸ‘¨', 'ğŸ‘¨â€â¤ï¸â€ğŸ‘¨', 'ğŸ‘©â€â¤ï¸â€ğŸ‘©', 'ğŸ’', 'ğŸŒ¹', 'ğŸŒº', 'ğŸŒ¸', 'ğŸŒ·'],
      cute: ['ğŸ¥°', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ¥º', 'ğŸ˜Œ', 'ğŸ˜š', 'ğŸ¤—', 'ğŸ¥³', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ¤ª', 'ğŸ˜œ', 'ğŸ¥´', 'ğŸ¤¤', 'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸ¦„', 'ğŸŒˆ', 'â­', 'âœ¨'],
      funny: ['ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜†', 'ğŸ˜', 'ğŸ˜„', 'ğŸ˜ƒ', 'ğŸ˜€', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§', 'ğŸ¤”', 'ğŸ¤¨', 'ğŸ¤', 'ğŸ¤«', 'ğŸ¤­', 'ğŸ™„', 'ğŸ˜¬', 'ğŸ˜', 'ğŸ¥±', 'ğŸ˜´', 'ğŸ¤ ', 'ğŸ¤¡', 'ğŸ‘»', 'ğŸ‘½', 'ğŸ¤–', 'ğŸ’©', 'ğŸ”¥', 'ğŸ’¯', 'ğŸ‘', 'ğŸ‘Œ']
    };

    let currentUser = null;
    let unsubscribeMessages = null;

    // App state
    const state = {
      currentEmojiCategory: 'romantic'
    };

    // Render authentication screen
    function renderAuth() {
      return `
        <div class="auth-screen">
          <div class="auth-card">
            <div class="auth-heart">ğŸ’•</div>
            <h1 class="auth-title">Our Private Chat</h1>
            <p class="auth-subtitle">Enter your credentials to continue</p>
            
            <div id="authError" class="error-message"></div>
            
            <div class="input-group">
              <label class="input-label" for="email">Email</label>
              <input type="email" id="email" class="input-field" placeholder="your@email.com" autocomplete="email">            </div>
            
            <div class="input-group">
              <label class="input-label" for="password">Password</label>
              <input type="password" id="password" class="input-field" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
          </div>
            
            <button id="loginBtn" class="auth-button">Sign In</button>
          </div>
        </div>
      `;
    }

    // Render chat screen
    function renderChat() {
      return `
        <div class="app-container">
          <header class="chat-header">
            <div class="header-user">
              <div class="header-avatar">ğŸ’•</div>
              <div class="header-info">
                <h3 id="partnerName">mine</h3>
                <div class="header-status">ğŸ’– Private Chat</div>
              </div>
            </div>
            <button id="logoutBtn" class="logout-button">Logout</button>
          </header>

          <div id="messagesContainer" class="messages-container">
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ’¬</div>
              <div class="empty-state-text">Start your conversation ğŸ’•</div>
            </div>
          </div>

          <div class="input-container">
            <button id="emojiBtn" class="emoji-button">ğŸ˜Š</button>
            <div class="message-input-wrapper">
              <textarea id="messageInput" class="message-input" placeholder="Type a message..." rows="1"></textarea>
            </div>
            <button id="sendBtn" class="send-button">â¤</button>
          </div>

          <div id="emojiPicker" class="emoji-picker">
            <div class="emoji-picker-header">
              <div class="emoji-picker-title">Choose an emoji</div>
              <button id="emojiClose" class="emoji-close">Ã—</button>
            </div>
            <div class="emoji-tabs">
              <button class="emoji-tab active" data-category="romantic">ğŸ’• Romantic</button>
              <button class="emoji-tab" data-category="cute">ğŸ¥° Cute</button>
              <button class="emoji-tab" data-category="funny">ğŸ˜‚ Funny</button>
            </div>
            <div id="emojiGrid" class="emoji-grid"></div>
          </div>
        </div>
      `;
    }

    // Render emoji grid
    function renderEmojiGrid(category) {
      const grid = document.getElementById('emojiGrid');
      if (!grid) return;
      
      grid.innerHTML = emojiCategories[category]
        .map(emoji => `<button class="emoji-item">${emoji}</button>`)
        .join('');
      
      // Add click handlers
      grid.querySelectorAll('.emoji-item').forEach(btn => {
        btn.addEventListener('click', () => {
          const input = document.getElementById('messageInput');
          input.value += btn.textContent;
          input.focus();
          document.getElementById('emojiPicker').classList.remove('show');
        });
      });
    }

    // Render messages
    function renderMessage(msg, isOwn) {
      const time = msg.timestamp ? new Date(msg.timestamp.toDate()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 'Now';
      
      return `
        <div class="message ${isOwn ? 'sent' : 'received'}">
          <div class="message-bubble">${msg.text}</div>
          <div class="message-time">${time}</div>
        </div>
      `;
    }

    // Show error
    function showError(message) {
      const errorEl = document.getElementById('authError');
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.classList.add('show');
        setTimeout(() => errorEl.classList.remove('show'), 5000);
      }
    }

    // Handle authentication
    async function handleAuth(email, password) {
      if (!ALLOWED_USERS.includes(email)) {
        showError('Access denied. This chat is private.');
        return;
      }

      try {
        const loginBtn = document.getElementById('loginBtn');
        if (loginBtn) loginBtn.disabled = true;

        try {
          await signInWithEmailAndPassword(auth, email, password);
        } catch (signInError) {
          if (signInError.code === 'auth/user-not-found') {
            await createUserWithEmailAndPassword(auth, email, password);
          } else {
            throw signInError;
          }
        }
      } catch (error) {
        console.error('Auth error:', error);
        showError(error.message || 'Authentication failed');
        const loginBtn = document.getElementById('loginBtn');
        if (loginBtn) loginBtn.disabled = false;
      }
    }

    // Send message
    async function sendMessage(text) {
      if (!text.trim() || !currentUser) return;

      try {
        await addDoc(collection(db, 'messages'), {
          text: text.trim(),
          userId: currentUser.uid,
          userEmail: currentUser.email,
          timestamp: serverTimestamp()
        });

        const input = document.getElementById('messageInput');
        if (input) {
          input.value = '';
          input.style.height = 'auto';
        }
      } catch (error) {
        console.error('Error sending message:', error);
      }
    }

    // Subscribe to messages
    function subscribeToMessages() {
      if (unsubscribeMessages) {
        unsubscribeMessages();
      }

      const q = query(collection(db, 'messages'), orderBy('timestamp', 'asc'));
      
      unsubscribeMessages = onSnapshot(q, (snapshot) => {
        const container = document.getElementById('messagesContainer');
        if (!container) return;

        if (snapshot.empty) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ’¬</div>
              <div class="empty-state-text">Start your conversation ğŸ’•</div>
            </div>
          `;
          return;
        }

        container.innerHTML = snapshot.docs
          .map(doc => {
            const msg = doc.data();
            return renderMessage(msg, msg.userId === currentUser.uid);
          })
          .join('');

        // Scroll to bottom
        container.scrollTop = container.scrollHeight;
      });
    }

    // Setup chat event listeners
    function setupChatListeners() {
      // Logout
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', () => signOut(auth));
      }

      // Send button
      const sendBtn = document.getElementById('sendBtn');
      const messageInput = document.getElementById('messageInput');
      
      if (sendBtn && messageInput) {
        sendBtn.addEventListener('click', () => sendMessage(messageInput.value));
        
        messageInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage(messageInput.value);
          }
        });

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
          this.style.height = 'auto';
          this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });
      }

      // Emoji picker
      const emojiBtn = document.getElementById('emojiBtn');
      const emojiPicker = document.getElementById('emojiPicker');
      const emojiClose = document.getElementById('emojiClose');
      
      if (emojiBtn && emojiPicker) {
        emojiBtn.addEventListener('click', () => {
          emojiPicker.classList.toggle('show');
          renderEmojiGrid(state.currentEmojiCategory);
        });
      }
      
      if (emojiClose) {
        emojiClose.addEventListener('click', () => {
          emojiPicker.classList.remove('show');
        });
      }

      // Emoji tabs
      document.querySelectorAll('.emoji-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.emoji-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          state.currentEmojiCategory = tab.dataset.category;
          renderEmojiGrid(state.currentEmojiCategory);
        });
      });
    }

    // Setup auth event listeners
    function setupAuthListeners() {
      const loginBtn = document.getElementById('loginBtn');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');

      if (loginBtn && emailInput && passwordInput) {
        loginBtn.addEventListener('click', () => {
          handleAuth(emailInput.value, passwordInput.value);
        });

        passwordInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            handleAuth(emailInput.value, passwordInput.value);
          }
        });
      }
    }

    // Initialize app
    onAuthStateChanged(auth, (user) => {
      const appEl = document.getElementById('app');
      
      if (user) {
        currentUser = user;
        appEl.innerHTML = renderChat();
        setupChatListeners();
        subscribeToMessages();
      } else {
        currentUser = null;
        if (unsubscribeMessages) {
          unsubscribeMessages();
          unsubscribeMessages = null;
        }
        appEl.innerHTML = renderAuth();
        setupAuthListeners();
      }
    });
  </script>
</body>
</html>
